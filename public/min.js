let socket,loading=!1;const redirect=async e=>{if("object"==typeof e&&e.preventDefault(),loading)return;loading=!0;const t="object"==typeof e?e.target.href:e;if(window.location.href==t)return;const o=setTimeout((()=>window.location.href=t),5e3),c=await fetch(t,{method:"POST",body:JSON.stringify({header:!1}),headers:{"Content-Type":"application/json"}});clearTimeout(o),document.body.innerHTML=await c.text(),document.querySelectorAll("a").forEach((e=>e.onclick=redirect));const a=(t||"/").replace(window.location.origin,"");updateURL(a,!0),update(),loading=!1},updateURL=(e,t)=>{t&&window.history.pushState({},"",e);const o=e.replaceAll("/"," ").replace("signup","sign up"),c=o.replace(/(^\w{1})|(\s+\w{1})/g,(e=>e.toUpperCase()));document.title="/join"==window.location.pathname?"Play "+appName+"! - Enter game code here | "+appName:c&&" "!=o?c+" | "+appName:e.split("?")[0].endsWith("/")?appName+" - live learning game show":appName},validateEmail=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),signupOrLogin=e=>{if(e.target.classList.contains("disabled"))return;const t=document.querySelector("#email");validateEmail(t.value)},updateLogin=()=>{if("/login"!=window.location.pathname&&"/signup"!=window.location.pathname)return;const e=document.querySelector("#continue");document.querySelector("#email").oninput=t=>{validateEmail(t.target.value)?e.classList.remove("disabled"):e.classList.add("disabled")},e.onclick=signupOrLogin};let gamecode=!1;const setupCanvas=e=>{const t=e.getContext("2d"),o="#52b757",c="#1d2d35",a="#ffffff",l=document.querySelector("#color-0"),n=document.querySelector("#color-1"),r=document.querySelector("#pen"),s=document.querySelector("#marker"),i=document.querySelector("#eraser");l.querySelector(".color").style.background=c,n.querySelector(".color").style.background=a;const d={x:0,y:0,click:!1,curr:c,w:10,h:10},u=document.querySelector("#pen-c").getContext("2d");let g,m;e.width=screen.width,e.height=screen.height,u.canvas.width=screen.width,u.canvas.height=screen.height,window.onresize=()=>{e.width=screen.width,e.height=screen.height},l.onclick=()=>{l.classList.add("toggled"),n.classList.remove("toggled"),d.curr==o&&(d.w=d.h=10,i.classList.remove("toggled"),r.classList.add("toggled")),d.curr=c},n.onclick=()=>{n.classList.add("toggled"),l.classList.remove("toggled"),d.curr==o&&(d.w=d.h=10,i.classList.remove("toggled"),r.classList.add("toggled")),d.curr=a},r.onclick=()=>{r.classList.add("toggled"),s.classList.remove("toggled"),i.classList.remove("toggled"),d.w=d.h=10,d.curr==o&&(d.curr=c,l.classList.add("toggled"))},s.onclick=()=>{s.classList.add("toggled"),r.classList.remove("toggled"),i.classList.remove("toggled"),d.w=d.h=15,d.curr==o&&(d.curr=c,l.classList.add("toggled"))},i.onclick=()=>{i.classList.add("toggled"),r.classList.remove("toggled"),s.classList.remove("toggled"),l.classList.remove("toggled"),n.classList.remove("toggled"),d.w=d.h=18,d.curr=o};e.onmousemove=e.ontouchmove=e=>{if(m&&(m=structuredClone(d)),d.x=e.touches?e.touches[0].clientX:e.clientX,d.y=e.touches?e.touches[0].clientY:e.clientY,u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.fillStyle=d.curr,u.arc(d.x,d.y,d.w,0,2*Math.PI),u.fill(),u.closePath(),d.y>window.innerHeight-95)return d.click=m=!1;g=d,d.click&&(m||(m=structuredClone(d)),t.beginPath(),t.strokeStyle=g.curr,t.lineWidth=2*g.w,t.moveTo(g.x,g.y),t.lineTo(m.x,m.y),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=g.curr,t.arc(g.x,g.y,g.w,0,2*Math.PI),t.fill(),t.closePath())},e.onmousedown=e.ontouchstart=()=>{d.click=!0,t.beginPath(),t.fillStyle=d.curr,t.arc(d.x,d.y,d.w,0,2*Math.PI),t.fill(),t.closePath()},e.onmouseup=e.ontouchend=()=>{d.click=m=!1,t.beginPath(),t.fillStyle=d.curr,t.arc(d.x,d.y,d.w,0,2*Math.PI),t.fill(),t.closePath()}},checkGamecodeOrUsername=()=>{const e=document.querySelector("#game-code");if(0==e.value.length)return;const t=document.querySelector("#form");if(gamecode){const o=e.value;socket&&socket.emit("joinGame",{name:o},(e=>{t.style.transform="scale(0.95)",t.style.opacity=0,setTimeout((async()=>{const e=await fetch("/player",{method:"POST",body:JSON.stringify({header:!1}),headers:{"Content-Type":"application/json"}});document.body.innerHTML=await e.text();const t=document.querySelector("#cont");t.onclick=e=>{t.style.display="none",document.querySelector("#draw-dock").style.display="flex";const o=document.querySelector("#draw");setupCanvas(o)}}),500)}))}else socket&&socket.emit("checkGamecode",{gamecode:e.value},(o=>{o&&(gamecode=e.value,t.style.transform="scale(0.95)",t.style.opacity=0,setTimeout((()=>{e.blur(),e.value="",e.type="text",e.placeholder="Your Name",t.style=""}),500))}))},updateJoin=()=>{if("/join"!=window.location.pathname)return document.querySelector("meta[name='theme-color']").setAttribute("content","#000000");socket=io(),gamecode=!1,document.querySelector("#join-game").onclick=()=>checkGamecodeOrUsername(),document.querySelector("#game-code").onkeyup=e=>"Enter"==e.key?checkGamecodeOrUsername():"",document.querySelector("meta[name='theme-color']").setAttribute("content","#4252af");const e=window.location.search,t=new URLSearchParams(e).get("gc");t&&(document.querySelector("#game-code").value=t,checkGamecodeOrUsername())},update=()=>{document.querySelectorAll("a").forEach((e=>e.onclick=redirect)),document.querySelectorAll("#menu svg").forEach((e=>e.onclick=toggleMenu)),document.querySelectorAll("#close-menu").forEach((e=>e.onclick=toggleMenu)),document.querySelectorAll(".menu-bg").forEach((e=>e.onclick=toggleMenu)),updateLogin(),updateJoin()},toggleMenu=()=>{document.querySelector("#nav.menu").classList.toggle("toggled")};window.onload=()=>update(),window.onpopstate=()=>{redirect(document.referrer)},updateURL(window.location.pathname,!1);