let socket,loading=!1;const redirect=async e=>{if("object"==typeof e&&e.preventDefault(),loading)return;loading=!0;const t="object"==typeof e?e.target.href:e;if(window.location.href==t)return;const o=setTimeout((()=>window.location.href=t),5e3),c=await fetch(t,{method:"POST",body:JSON.stringify({header:!1}),headers:{"Content-Type":"application/json"}});clearTimeout(o),document.body.innerHTML=await c.text(),document.querySelectorAll("a").forEach((e=>e.onclick=redirect));const n=(t||"/").replace(window.location.origin,"");updateURL(n,!0),update(),loading=!1},updateURL=(e,t)=>{t&&window.history.pushState({},"",e);const o=e.replaceAll("/","").replace("signup","sign up").replace(/(^\w{1})|(\s+\w{1})/g,(e=>e.toUpperCase()));document.title="/join"==window.location.pathname?"Play "+appName+"! - Enter game code here | "+appName:o?o+" | "+appName:e.split("?")[0].endsWith("/")?appName+" - live learning game show":appName},validateEmail=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),signupOrLogin=e=>{if(e.target.classList.contains("disabled"))return;const t=document.querySelector("#email");validateEmail(t.value)},updateLogin=()=>{if("/login"!=window.location.pathname&&"/signup"!=window.location.pathname)return;const e=document.querySelector("#continue");document.querySelector("#email").oninput=t=>{validateEmail(t.target.value)?e.classList.remove("disabled"):e.classList.add("disabled")},e.onclick=signupOrLogin};let gamecode=!1;const setupCanvas=e=>{const t=e.getContext("2d"),o="#1d2d35",c="#ffffff",n=document.querySelector("#color-0"),a=document.querySelector("#color-1");n.querySelector(".color").style.background=o,a.querySelector(".color").style.background=c;const l={x:0,y:0,click:!1,curr:o,w:15,h:15};n.onclick=()=>{n.classList.add("toggled"),a.classList.remove("toggled"),l.curr=o},a.onclick=()=>{a.classList.add("toggled"),n.classList.remove("toggled"),l.curr=c};const r=[],i=e=>{l.x=e.touches?e.touches[0].clientX:e.clientX,l.y=e.touches?e.touches[0].clientY:e.clientY,l.click&&r.push(structuredClone(l))},u=document.querySelector("#container");u.onmousemove=i,u.ontouchmove=i,u.onmousedown=()=>{l.click=!0,r.push(structuredClone(l))},u.ontouchstart=()=>{l.click=!0,r.push(structuredClone(l))},u.onmouseup=()=>{l.click=!1,r.push(!1)},u.ontouchend=()=>{l.click=!1,r.push(structuredClone(!1))};const s=()=>{requestAnimationFrame(s),e.width=window.innerWidth,e.height=window.innerHeight,t.clearRect(0,0,e.width,e.height),t.beginPath(),t.fillStyle=l.curr,t.arc(l.x,l.y,l.w,l.h,0,2*Math.PI),t.fill(),t.closePath(),r.forEach(((e,o)=>{const c=r[o+1];t.beginPath(),t.fillStyle=e.curr,t.arc(e.x,e.y,e.w,e.h,0,2*Math.PI),t.fill(),t.closePath(),c&&(t.beginPath(),t.strokeStyle=e.curr,t.lineWidth=2*e.w,t.moveTo(e.x,e.y),t.lineTo(c.x,c.y),t.stroke(),t.closePath())}))};s()},checkGamecodeOrUsername=e=>{const t=document.querySelector("#game-code");if(0==t.value.length)return;const o=document.querySelector("#form");if(gamecode){const e=t.value;socket&&socket.emit("joinGame",{name:e},(e=>{o.style.transform="scale(0.95)",o.style.opacity=0,setTimeout((async()=>{const e=await fetch("/player",{method:"POST",body:JSON.stringify({header:!1}),headers:{"Content-Type":"application/json"}});document.body.innerHTML=await e.text();const t=document.querySelector("#cont");t.onclick=e=>{t.style.display="none",document.querySelector("#draw-dock").style.display="flex";const o=document.querySelector("#draw");setupCanvas(o)}}),500)}))}else socket&&socket.emit("checkGamecode",{gamecode:t.value},(e=>{e&&(gamecode=t.value,o.style.transform="scale(0.95)",o.style.opacity=0,setTimeout((()=>{t.blur(),t.value="",t.type="text",t.placeholder="Your Name",o.style=""}),500))}))},updateJoin=()=>{if("/join"!=window.location.pathname)return document.querySelector("meta[name='theme-color']").setAttribute("content","#000000");socket=io(),gamecode=!1,document.querySelector("#join-game").onclick=checkGamecodeOrUsername,document.querySelector("#game-code").onkeyup=e=>"Enter"==e.key?checkGamecodeOrUsername():"",document.querySelector("meta[name='theme-color']").setAttribute("content","#4252af")},update=()=>{document.querySelectorAll("a").forEach((e=>e.onclick=redirect)),document.querySelectorAll("#menu svg").forEach((e=>e.onclick=toggleMenu)),document.querySelectorAll("#close-menu").forEach((e=>e.onclick=toggleMenu)),document.querySelectorAll(".menu-bg").forEach((e=>e.onclick=toggleMenu)),updateLogin(),updateJoin()},toggleMenu=()=>{document.querySelector("#nav.menu").classList.toggle("toggled")};window.onload=()=>update(),window.onpopstate=()=>{redirect(document.referrer)},updateURL(window.location.pathname,!1);